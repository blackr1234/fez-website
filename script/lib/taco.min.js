var taco={noop:function(){},isNumeric:function(e){return"number"!=typeof e?!1:e===parseFloat(e)&&isFinite(e)},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},typeOf:function(e){return void 0===e?"undefined":null===e?"null":taco.isArray(e)===!0?"array":taco.isNumeric(e)===!0?"number":typeof e},boot:function(e,t){taco.net.xhrIo({url:e,success:function(e){for(var r,n,o,a=e.responseXML,i=a.getElementsByTagName("boot"),l=0,c=i.length,s={};c>l;l++)r=i[l],n=r.getAttribute("name"),o=taco.dom.innerText(r),s[n]=o;t(s)}})},forRange:function(e,t,r){for(var n;t>e;e++)if(n=r(e),void 0!==n){if(n===!0)continue;break}}};taco.net={urlParameter:function(e,t){var r,n,o=location.search,a=taco.string.build(e,"="),i=o.indexOf(a);return-1===i?t||null:(r=a.length+i,n=o.indexOf("&",r),-1===n&&(n=o.length),o.substring(r,n))},urlCacheClear:function(e,t,r){return-1===e.indexOf("?")?e+="?":"&"!==taco.string.lastChar(e)&&(e+="&"),(void 0===t||taco.isNumeric(t)===!1&&"string"!=typeof t)&&(t=(new Date).getTime()),void 0===r&&(r="__taco__"),taco.string.build(e,r,"=",t)},urlFileName:function(e,t){var r=e.match(".+/(.+?).[ a-z ]+([ ?#; ].*)?$");return null!==r?r[1]:t||null},urlFileNameReplace:function(e,t,r){var n=taco.net.urlFileName(e);return null!==n?e.replace(n,t):r||null},xhrIo:function(e){return new function(e){var t=taco.object.merge({url:"",cache:!1,method:"GET",success:taco.noop,error:taco.noop,complete:taco.noop},e),r={self:this,xhrIo:null,abortTimerId:null};r.initXhrIo=function(){if(!window.ActiveXObject)return window.XMLHttpRequest?new XMLHttpRequest:null;try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){return null}}},r.xhrIoAddChangeStateEvent=function(){r.xhrIo.onreadystatechange=function(){try{4===Number(r.xhrIo.readyState)&&(200===Number(r.xhrIo.status)?t.success.call(r.self,r.xhrIo):t.error.call(r.self),t.complete.call(r.self))}catch(e){}}},r.send=function(){if(r.xhrIo=r.initXhrIo(),null!==r.xhrIo){r.xhrIoAddChangeStateEvent();try{var e=t.cache?t.url:taco.net.urlCacheClear(t.url);r.xhrIo.open(t.method,e),r.xhrIo.send(e)}catch(n){t.error.call(r.self)}}else t.error.call(r.self)},r.send()}(e)}},taco.string={build:function(){var e=[];return e.push.apply(e,arguments),e.join("")},trim:function(e){return e.replace(/^\s+|\s+$/g,"")},trimNewLine:function(e){return e.replace(/\n/g,"")},firstChar:function(e){return e.charAt(0)},lastChar:function(e){return e.charAt(e.length-1)},firstCharToUpperCase:function(e){return taco.string.build(taco.string.firstChar(e).toUpperCase(),e.slice(1))},firstCharToLowerCase:function(e){return taco.string.build(taco.string.firstChar(e).toLowerCase(),e.slice(1))},sprintf:function(){for(var e,t=arguments[0],r=1,n=arguments.length;n>r;r++)e=arguments[r],"string"==typeof e?t=t.replace("%s",e):taco.isNumeric(arguments[r])&&(t=t.replace("%d",e));return t},bracketReplacer:function(e,t){return new function(e,t){var r=this,n={expr:taco.string.build(e,"\\s*%s\\s*",t),replace:function(e,t,r){var o=new RegExp(taco.string.sprintf(n.expr,t),"ig");return e.replace(o,r)}};r.replace=function(e,t,r){if("string"==typeof t)return n.replace(e,t,r);var o;for(o in t)e=n.replace(e,o,t[o]);return e},r.sweep=function(e){return e.replace(new RegExp(taco.string.sprintf(n.expr,".*?"),"ig"),"")}}(e,t)},width:function(e){for(var t=e.split(""),r=0,n=t.length,o=0;n>r;r++)o+=taco.string.charWidth(t[r]);return o},charWidth:function(e){var t=e;return e.length>0&&(t=e.substring(0,1)),t=e.charCodeAt(0),255>=t||t>=65377&&65439>=t?1:2},evalJSON:function(e){return void 0!==JSON&&void 0!==JSON.parse?JSON.parse(e):window.eval(taco.string.build("(",e,")"))}},taco.array={clone:function(e){return e.slice()},shuffle:function(e){for(var t,e=taco.array.clone(e),r=[],n=e.length;n;)t=Math.floor(Math.random()*n),n-=1,r.push(e.splice(t,1)[0]);return r},each:function(e,t){for(var r,n=0,o=e.length;o>n;n++)if(r=t(n,e[n]),void 0!==r){if(r===!0)continue;break}},indexOf:function(e,t){for(var r=0,n=e.length;n>r;r++)if(t===e[r])return r;return-1}},taco.object={merge:function(){for(var e,t,r=[],n=0,o=arguments.length;o>n;n++){e=arguments[n];for(t in e)Object.prototype.hasOwnProperty.call(e,t)===!0&&(r[t]=e[t])}return r},each:function(e,t){var r,n,o=0;for(r in e)if(n=t(o++,e[r],r,e),void 0!==n){if(n===!0)continue;break}}},taco.json={serialize:function(e){var t=[];return taco.json._serialize(e,t),t.join("")},_serialize:function(e,t){switch(taco.typeOf(e)){case"string":t.push(taco.string.build('"',e,'"'));break;case"number":case"boolean":t.push(e);break;case"undefined":t.push("null");break;case"object":if("null"==typeof e)break;t=taco.json.serializeObject(e,t);break;case"array":t=taco.json.serializeArray(e,t)}},serializeArray:function(e,t){var r=0,n=e.length,o="";for(t.push("[");n>r;r++)t.push(o),taco.json._serialize(e[r],t),o=",";return t.push("]"),t},serializeObject:function(e,t){var r,n="";t.push("{");for(r in e)if(Object.prototype.hasOwnProperty.call(e,r)===!0){var o=e[r];"function"!=typeof o&&(t.push(n),t.push(taco.string.build('"',r,'"')),t.push(":"),taco.json._serialize(o,t),n=",")}return t.push("}"),t}},taco.cookies={get:function(e,t){for(var r,e=taco.string.build(e,"="),n=document.cookie,o=e.length,a=n.length,i=0,l=0;a>i;){if(l=i+o,n.substring(i,l)===e)return r=n.indexOf(";",l),-1===r&&(r=a),unescape(n.substring(l,r));if(i=n.indexOf(" ",i)+1,0===i)break}return t},set:function(e,t,r){if(void 0!==e){var n,o,a=taco.string.build(e,"=",escape(t)),i=taco.object.merge({path:null,domain:null,secure:null,expires:null,days:0,hours:0,minutes:0},r);(i.days>0||i.hours>0||i.minutes>0)&&(i.expires=taco.date.fromNow(i).toGMTString());for(n in i)o=i[n],"path"!==n&&"domain"!==n&&"secure"!==n&&"expires"!==n||null===o||(a=taco.string.sprintf("%s; %s=%s",a,n,o));document.cookie=a}}},taco.date={fromNow:function(e){var t=new Date,r=taco.object.merge({days:0,hours:0,minutes:0,seconds:0,milliseconds:0},e);return t.setDate(t.getDate()+r.days),t.setHours(t.getHours()+r.hours),t.setMinutes(t.getMinutes()+r.minutes),t.setSeconds(t.getSeconds()+r.seconds),t.setMilliseconds(t.getMilliseconds()+r.milliseconds),t}},taco.dom={innerText:function(e){var t,r="",n=0,o=e.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)r+=taco.dom.innerText(e);return r}if(3===o||4===o)return e.nodeValue;for(;t=e[n];n++)r+=taco.dom.innerText(t);return r}}},taco.event={listen:function(e,t,r,n){if(e.addEventListener)return e.addEventListener(t,r,n),!0;if(e.attachEvent){var o=e.attachEvent("on"+t,function(){r.call(e,window.event)});return o}e["on"+type]=r},unlisten:function(e,t,r){e.removeEventListener?e.removeEventListener(t,r):e.detachEvent?e.detachEvent("on"+t,r):e["on"+type]=taco.noop}},taco.browser={language:function(){var e=navigator;return void 0!==e.languages?e.languages[0]:e.language||e.browserLanguage||e.userLanguage}},taco.timer=function(e){return new function(e){var t=this,r=taco.object.merge({interval:100,delay:0,duration:0,start:taco.noop,stop:taco.noop,progress:taco.noop,pause:taco.noop,elapsed:!1},e),n={interval:0,delay:0,duration:0,timerId:null,delayTimerId:null,durationTimerId:null,startTime:0};n.doInterval=function(){n.startTime=(new Date).getTime(),n.delay>0?n.delayTimerId=setTimeout(function(){n.duration>0&&(n.durationTimerId=setTimeout(t.stop,n.duration)),n.start.call(t),n.timerId=setInterval(n.progress,n.interval)},n.delay):(n.duration>0&&(n.durationTimerId=setTimeout(t.stop,n.duration)),n.start.call(t),n.timerId=setInterval(n.progress,n.interval))},n.start=function(){var e=n.evtArgs();r.elapsed===!0&&(e.elapsed=0),r.start.call(t,e)},n.stop=function(){r.stop.call(t,n.evtArgs())},n.pause=function(){r.pause.call(t,n.evtArgs())},n.progress=function(){var e=n.evtArgs();r.elapsed===!0&&(e.elapsed=n.elapsed()),r.progress.call(t,e)},t.start=function(e){r=taco.object.merge(r,e),taco.isNumeric(n.delay)===!1&&(r.delay&&taco.isNumeric(r.delay)?n.delay=r.delay:n.delay=0),taco.isNumeric(n.duration)===!1&&(r.duration&&taco.isNumeric(r.duration)?n.duration=r.duration:n.duration=0),n.interval=r.interval,n.delay=r.delay,n.duration=r.duration,n.clearId(),n.doInterval()},n.clearId=function(){null!==n.timerId&&(clearTimeout(n.timerId),clearInterval(n.timerId),n.timerId=null),null!==n.delayTimerId&&(clearTimeout(n.delayTimerId),n.delayTimerId=null),null!==n.durationTimerId&&(clearTimeout(n.durationTimerId),n.durationTimerId=null)},n.evtArgs=function(){return{interval:n.interval,delay:n.delay,duration:n.duration}},t.stop=function(){n.clearId(),n.stop.call(t)},t.pause=function(){n.clearId(),n.pause.call(t)},n.elapsed=function(){return(new Date).getTime()-n.startTime}}(e)},taco.easing={calculator:function(e){return new function(e){var t=this,r=taco.object.merge({progress:taco.noop,end:taco.noop,interval:20},e),n={timer:null,from:null,to:null,easing:null,linear:function(e,t,r,n){return r*e/n+t},init:function(){n.timer=taco.timer({interval:r.interval,elapsed:!0,start:n.progress,progress:n.progress,stop:n.end})}};n.progress=function(e){if(taco.isNumeric(n.from)===!0)e.calcResult=n.easing(e.elapsed,n.from,n.to,e.duration);else{var o=0,a=n.from.length;for(e.calcResult=[];a>o;o++)e.calcResult.push(n.easing(e.elapsed,n.from[o],n.to[o],e.duration))}r.progress.call(t,e)},n.end=function(){r.end.call(t)},t.start=function(e,t,r,o){n.from=e,n.to=t,n.easing=void 0!==o?o:n.linear,n.timer.start({duration:r})},t.stop=function(){n.timer.pause()},n.init.call(t)}(e)},easeOutQuad:function(e,t,r,n){return-r*(e/=n)*(e-2)+t}},taco.window=function(e){return new function(e){var t=this,r=taco.object.merge({resize:taco.noop,scroll:taco.noop,changeStatus:!1,width:!1,height:!1,position:!1},e),n={oldWidth:null,oldHeight:null,oldPosition:null,scrollElement:null,init:function(){(r.width!==!1||r.height!==!1)&&(r.width!==!1&&t.width(r.width),r.height!==!1&&t.height(r.height)),(r.resize!==!1||r.width!==!1||r.height!==!1)&&taco.event.listen(window,"resize",n.resize),r.position!==!1&&t.position(r.position),(r.scroll!==!1||r.position!==!1)&&taco.event.listen(window,"scroll",n.scroll)}};t.position=function(e){taco.isNumeric(e)===!0&&(e=[e]),r.position=e.reverse()},t.width=function(e){taco.isNumeric(e)===!0&&(e=[e]),r.width=e.reverse()},t.height=function(e){taco.isNumeric(e)===!0&&(e=[e]),r.height=e.reverse()},t.callChangeStatus=function(){n.changeStatus(n.status())},t.scrollPosition=function(){return{left:document.documentElement.scrollLeft||document.body.scrollLeft,top:document.documentElement.scrollTop||document.body.scrollTop}},t.scrollTop=function(e,r,o){null===n.scrollElement&&(n.scrollElement=t.scrollElement()),void 0===n.easingCalc?n.easingCalc=taco.easing.calculator({interval:20,progress:function(e){n.scrollElement.scrollTop=e.calcResult},stop:function(){n.scrollElement.scrollTop=e}}):n.easingCalc.pause();var a=t.scrollPosition().top,i=e-a;n.easingCalc.start(t.scrollPosition().top,i,r,o||taco.easing.easeOutQuad)},t.scrollElement=function(){var e,r=t.scrollPosition(),n=document.documentElement,o=document.body;return window.scrollTo(r.left,r.top+1),n.scrollTop>0?e=n:o.scrollTop>0&&(e=o),window.scrollTo(r.left,r.top),e},t.viewportSize=function(){var e,t,r=window.innerHeight,n=document.documentElement;if(void 0!==r)window===window.top&&n.scrollHeight<r&&(r-=15),e=window.innerWidth,t=r;else if(void 0!==n&&0!==n.clientWidth)e=n.clientWidth,t=n.clientHeight;else{var o=document.getElementsByName("body")[0];e=o.clientWidth,t=o.clientHeight}return{width:e,height:t}},n.resize=function(e){var o;o=r.width!==!1||r.height!==!1?n.status(n.status()):t.viewportSize(),r.resize.call(t,taco.object.merge(e,o))},n.scroll=function(e){var o;o=r.position!==!1?n.status(n.status()):t.scrollPosition(),r.scroll.call(t,taco.object.merge(e,o))},n.changeStatus=function(e){r.changeStatus.call(t,e)},n.status=function(e){if(void 0===e){var o,a,i,l={};if(r.width!==!1||r.height!==!1){var c=t.viewportSize(),s=c.width,u=c.height;if(r.width!==!1){for(o=r.width.length,i=null,a=0;o>a;a++)s<r.width[a]&&(i=o-a-1);null===i&&(i=o),l.wide=i}if(r.height!==!1){for(o=r.height.length,i=null,a=0;o>a;a++)u<r.height[a]&&(i=o-a-1);null===i&&(i=o),l.high=i}l.width=s,l.height=u}if(r.position!==!1){var f=t.scrollPosition(),d=f.top,o=f.left;for(o=r.position.length,i=null,a=0;o>a;a++)d<r.position[a]&&(i=o-a-1);null===i&&(i=o),l.position=i,l.top=d,l.left=o}return l}return(r.width!==!1&&n.oldWidth!==e.width||r.height!==!1&&n.oldHeight!==e.height||r.position!==!1&&n.oldPosition!==e.position)&&(r.width!==!1&&n.oldWidth!==e.width&&(n.oldWidth=e.width),r.height!==!1&&n.oldHeight!==e.height&&(n.oldHeight=e.height),r.position!==!1&&n.oldPosition!==e.position&&(n.oldPosition=e.position),n.changeStatus(e)),e},n.init.call(t)}(e)},taco.number={toBinaryString:function(e){for(var t=0,r=[],n="";e>0;t++)r[t]=e%2,e=Math.floor(e/2);for(;t>0;)n+=r[--t];return n},zerofill:function(e,t){e=e.toString();var r=t-e.length;if(0>=r)return e;for(var n=0,o=[];r>n;n++)o.push("0");return o.push(e),o.join("")}},taco.binary={flag:function(e,t,r){return 0>=t?void 0:(t-=1,r===!0?e|1<<t:~(~e|1<<t))}},taco.pager=function(e){return new function(e){var t=this,r=taco.object.merge({page:1,length:1,step:1,change:taco.noop,update:taco.noop,first:taco.noop,last:taco.noop,beforeFirst:taco.noop,beforeLast:taco.noop,init:taco.noop},e),n={index:0,page:1,maxPage:0,init:function(){n.maxPage=Math.ceil(r.length/r.step),t.page(r.page),r.init.call(t)}};n.callChange=function(){r.change.call(t,n.evtOptions())},n.indexAndTo=function(){var e=(n.page-1)*r.step,t=e+r.step;return t>r.length&&(t=r.length),{index:e,to:t}},n.evtOptions=function(){return taco.object.merge({step:r.step,length:r.length,page:n.page,maxPage:n.maxPage},n.indexAndTo())},t.next=function(){n.page<n.maxPage&&(n.page+=1,t.page(n.page))},t.prev=function(){n.page>1&&(n.page-=1,t.page(n.page))},t.first=function(){n.page=1,t.page(n.page)},t.last=function(){n.page=n.maxPage,t.page(n.page)},t.page=function(e){if(e>=0&&e<=n.maxPage)n.page=e,2===n.page&&r.beforeFirst.call(t),1===n.page&&r.first.call(t),n.page===n.maxPage-1&&r.beforeLast.call(t),n.page===n.maxPage&&r.last.call(t),n.callChange();else if(void 0===e)return n.page},t.setOption=function(e){r=taco.object.merge(r,e),n.maxPage=Math.ceil(r.length/r.step),n.page=1,r.update.call(t,n.evtOptions())},t.maxPage=function(){return n.maxPage},n.init.call(t)}(e)},taco.tag=function(options){return new function(options){var self=this,opts=taco.object.merge({cache:!1,auto:!1,source:null,vars:{},complete:taco.noop},options),vars={};vars.dotSyntaxToArrayLiteral=function(e){return taco.string.build('["',e.replace(new RegExp("\\.","ig"),'"]["'),'"]')},vars.getRange=function(value){var range=value.match(new RegExp("\\s*range\\s*\\(\\s*(.*?)\\s*\\)","i"));return null===range?0:(range=parseInt(eval(RegExp.$1)),taco.isNumeric(range)===!1?0:range)},self.evalLoopDoubleBrackets=function(source,key,value,index,maxlength){var expr=taco.string.sprintf("{{\\s*%s.%s\\s*}}",key),reg,match,valEval;if(source=source.replace(new RegExp(taco.string.sprintf(expr,""),"ig"),value).replace(new RegExp(taco.string.sprintf(expr,"index"),"ig"),index).replace(new RegExp(taco.string.sprintf(expr,"count"),"ig"),index+1).replace(new RegExp(taco.string.sprintf(expr,"lastIndex"),"ig"),maxlength-index-1).replace(new RegExp(taco.string.sprintf(expr,"lastCount"),"ig"),maxlength-index),expr=taco.string.sprintf("%s.%s",key),source=source.replace(new RegExp(taco.string.sprintf(expr,"index"),"ig"),index).replace(new RegExp(taco.string.sprintf(expr,"count"),"ig"),index+1).replace(new RegExp(taco.string.sprintf(expr,"lastIndex"),"ig"),maxlength-index-1).replace(new RegExp(taco.string.sprintf(expr,"lastCount"),"ig"),maxlength-index).replace(new RegExp(taco.string.sprintf(expr,"first"),"ig"),(0===index).toString()).replace(new RegExp(taco.string.sprintf(expr,"last"),"ig"),(index===maxlength-1).toString()).replace(new RegExp(taco.string.sprintf(expr,"even"),"ig"),index%2===0).replace(new RegExp(taco.string.sprintf(expr,"odd"),"ig"),index%2!==0),taco.isNumeric(value)===!1)for(expr=taco.string.sprintf("{{\\s*%s.(.*?)\\s*}}",key),reg=new RegExp(expr,"i");match=source.match(reg);)valEval=eval(taco.string.build("value",vars.dotSyntaxToArrayLiteral(RegExp.$1))),void 0===valEval&&(valEval=""),source=source.replace(reg,valEval);return source},self.evalDoubleBrackets=function(e,t){var r,n,o=vars.seachDoubleBrackets(e),a=0;if(null===o)return e;for(;r=o[a];a++)try{n=self.evalDoubleBracket(r,t)||""}catch(i){n=""}finally{e=e.replace(r,n)}return e},vars.seachDoubleBrackets=function(e){return e.match(new RegExp("{{(.*?)}}","ig"))},self.evalDoubleBracket=function(bracket,optValueMap){var expr=vars.trimDoubleBracket(bracket),isEncode=!1,match=expr.match(new RegExp("\\s*\\|\\s*e\\s*")),value;null!==match&&(expr=expr.replace(match[0],""),isEncode=!0);try{void 0!==optValueMap&&(value=eval(taco.string.build("optValueMap.",expr))),void 0===value&&(value=eval(taco.string.build("opts.vars.",expr))),void 0===value&&(value=eval(expr))}catch(e){value=eval(expr)}finally{return isEncode?encodeURIComponent(value):value}},vars.trimDoubleBracket=function(e){return e.substring(2,e.length-2)},self.sweepAllBrackets=function(e){return e.replace(new RegExp("{{.*?}}","ig"),"").replace(new RegExp("{%.*?%}","ig"),"")},self.searchBracketByName=function(e,t){var r,n,o,a,i,l,c,s,u;return r=e.match(new RegExp(taco.string.build("{%\\s*end",t,"\\s*%}"),"i")),null===r?(a=e.length,r=""):(a=r.index,r=r.toString()),i=e.substring(0,a),n=i.match(new RegExp(taco.string.build("{%\\s*",t," *(.*?)\\s*%}"),"ig")),null===n?!1:(n=n.pop().toString(),o=i.lastIndexOf(n),""===r&&(a=o+n.length),l=e.substring(0,o),c=e.substring(o+n.length,a),s=e.substring(a+r.length,e.length),u=RegExp.$1,""!==u&&(u=u.replace("&amp;","&"),u=u.replace("&gt;",">"),u=u.replace("&lt;","<")),{before:l,inside:c,after:s,attr:u,open:n})},self.doSet=function(source){for(var ret,attr,name,value;ret=self.searchBracketByName(source,"set");)try{attr=ret.attr.split("="),name=taco.string.trim(attr[0]),value=eval(taco.string.trim(attr[1])),opts.vars[name]=value,window[name]=value}catch(e){}finally{source=taco.string.build(ret.before,ret.after)}return source},self.doIf=function(e){return vars.doIf(e,"if")},self.doEarlyif=function(e){return vars.doIf(e,"earlyif")},vars.doIf=function(source,tagName){for(var ret,insideCode;ret=self.searchBracketByName(source,tagName);)insideCode=vars.doElseIf(eval(ret.attr),ret.inside),source=taco.string.build(ret.before,insideCode,ret.after);return source},vars.doElseIf=function(result,source){var elifBlock=self.searchBracketByName(source,"elif"),elseBlock=self.searchBracketByName(source,"else");if(elseBlock===!1&&elifBlock===!1)return result===!0?source:"";if(elseBlock!==!1&&(source=elseBlock.before),elifBlock===!1)return result===!0?elseBlock.before:elseBlock.after;for(var after=!1;elifBlock=self.searchBracketByName(source,"elif");)eval(elifBlock.attr)===!0&&(after=elifBlock.after),source=elifBlock.before;return result===!0?source:after!==!1?after:elseBlock!==!1?elseBlock.after:""},self.doSwitch=function(source){for(var ret,insideCode;ret=self.searchBracketByName(source,"switch");){try{insideCode=vars.doCase(eval(ret.attr),ret.inside)}catch(e){insideCode=""}source=taco.string.build(ret.before,insideCode,ret.after)}return source},vars.doCase=function(result,source){for(var ret,insideCode;ret=self.searchBracketByName(source,"case");){try{if(eval(ret.attr)==result)return ret.inside}catch(e){return""}source=taco.string.build(ret.before,ret.after)}return ret=self.searchBracketByName(source,"default"),ret!==!1?ret.inside:""},self.doInclude=function(e,t){var r,n=self.searchBracketByName(e,"include");n===!1?t.call(self,e):(r=taco.string.trim(n.attr),r=self.evalDoubleBrackets(r),vars._doInclude(r,n,t))},vars._doInclude=function(e,t,r){var n;taco.net.xhrIo({cache:opts.cache,url:taco.string.build(e),success:function(e){n=e.responseText,n=self.doSet(n),n=taco.string.build(t.before,n,t.after),self.doInclude(n,r)},error:function(){n=taco.string.build(t.before,t.after),self.doInclude(n,r)}})},self.doFor=function(e){for(var t,r;t=self.searchBracketByName(e,"for");)r=t.attr,e=r.indexOf(" in ")<0?taco.string.build(t.before,t.after):vars._doFor(t);return e},vars._doFor=function(result){var attr=result.attr.split(" in "),key=taco.string.trim(attr[0]),expr=taco.string.trim(attr[1]),range=vars.getRange(expr),loop=[],i=0;try{if(0===range){if(expr=eval(expr),taco.isArray(expr))for(;i<expr.length;i++)loop.push(self.evalLoopDoubleBrackets(result.inside,key,expr[i],i,expr.length))}else for(;range>i;i++)loop.push(self.evalLoopDoubleBrackets(result.inside,key,i,i,range))}catch(e){loop=[]}finally{return taco.string.build(result.before,loop.join(""),result.after)}},self.doCSS=function(e){var t,r,n=document.createElement("LINK"),o=document.getElementsByTagName("HEAD")[0];for(n.setAttribute("rel","stylesheet");t=self.searchBracketByName(e,"css");)r=n.cloneNode(),r.setAttribute("href",t.attr),o.appendChild(r),e=taco.string.build(t.before,t.after);return e},self.setVars=function(e){opts.vars=e},self.makeSource=function(e,t){e=self.doSet(e),e=self.doEarlyif(e),self.doInclude(e,function(e){e=self.doFor(e),e=self.evalDoubleBrackets(e),e=self.doIf(e),e=self.doSwitch(e),e=self.doCSS(e),e=self.sweepAllBrackets(e),opts.complete.call(self,{source:e}),void 0!==t&&t.call(self,{source:e})})},opts.auto===!0&&self.makeSource(opts.source)}(options)},taco.source=function(e){return new function(e){var t=this,r=taco.object.merge({cache:!1,type:"",complete:taco.noop},e),n={queue:[],numQueue:0,textData:{},viewData:{},complete:!1};t.addQueue=function(e,t,r){n.queue.push({type:e,name:t,url:r})},t.startLoad=function(e){void 0!==e&&(n.complete=e),n.numQueue=n.queue.length,n.load()},t.getViewByName=function(e){return n.viewData[e]},t.getTextByName=function(e){return n.textData[e]},t.getTextMap=function(){return n.textData},n.load=function(){if(n.numQueue>0){var e=n.queue.shift();n.loadFileByTypeAndName(e.type,e.name,e.url)}},n.loadComplete=function(){n.numQueue-=1,0===n.numQueue?(r.complete.call(t),n.complete.call(t)):n.load()},n.loadFileByTypeAndName=function(e,t,o){try{taco.net.xhrIo({url:o,cache:r.cache,success:function(r){"text"===e?n.addTextData(t,r.responseXML):"view"===e&&n.addViewData(t,r.responseText)},complete:n.loadComplete,error:n.loadComplete})}catch(a){n.loadComplete()}},n.addTextData=function(e,t){for(var o,e,a,i,l,c=t.getElementsByTagName("text"),s=0,u=c.length;u>s;s++)l=c[s],a=taco.dom.innerText(l),e=l.getAttribute("name"),o=l.getAttribute("type"),i=l.getAttribute("list"),(void 0===o&&void 0===n.textData[e]||o===r.type||""===r.type)&&(null!==i&&void 0!==i&&(void 0===n.textData[i]?n.textData[i]=[a]:void 0!==n.textData[e]&&o===r.type?n.textData[i][n.textData[i].length-1]=a:n.textData[i].push(a)),n.textData[e]=a)},n.addViewData=function(e,t){n.viewData[e]=t}}(e)},taco.template=function(e){return new function(e){var t=this,r=taco.object.merge({cache:!1,source:"",vars:{},type:"",ready:taco.noop,complete:taco.noop},e),n={tag:taco.tag({auto:!1,cache:r.cache,source:r.source,vars:r.vars}),source:taco.source({type:r.type,cache:r.cache,complete:r.ready})};t.makeSource=function(){var e=r.source;e=n.doInsert(e),e=n.tag.doSet(e),e=n.doBlock(e),e=n.tag.doEarlyif(e),e=n.tag.doInclude(e,function(e){e=n.tag.doFor(e),e=n.doTextList(e),e=n.doText(e),e=n.tag.evalDoubleBrackets(e),e=n.tag.doIf(e),e=n.tag.doSwitch(e),e=n.tag.doCSS(e),e=n.tag.sweepAllBrackets(e),r.complete.call(t,{source:e})})},n.doInsert=function(e){for(var t,r,o;t=n.tag.searchBracketByName(e,"insert");)r=taco.net.urlFileName(t.attr,null),o=null!==r?n.source.getViewByName(r)||"":"",e=taco.string.build(t.before,o,t.after);return e},n.doExtends=function(e){for(var t,r,o,a,i;t=n.tag.searchBracketByName(e,"extends");)if(e=taco.string.build(t.before,t.after),o=taco.net.urlFileName(t.attr),a=n.source.getViewByName(o),void 0!==a)if(void 0!==i){if(r=n.tag.searchBracketByName(a,"filling"),r===!1)break;i=taco.string.build(r.before,i,r.after)}else i=a,a="";return i||e},n.doBlock=function(e){var t,r,o,a=[],i={},l="{{\\s*super\\s*}}";for(r=n.doExtends(e),o=e;t=n.tag.searchBracketByName(o,"block");)a[t.attr]=t.inside,o=taco.string.build(t.before,t.after);for(;t=n.tag.searchBracketByName(r,"block");)i=a[t.attr],i=void 0!==i?i.replace(new RegExp(l,"ig"),t.inside):t.inside,r=taco.string.build(t.before,i,t.after);return r},n.doTextList=function(e){for(var t,r,o,a,i,l,c,s;t=n.tag.searchBracketByName(e,"list");){if(r=t.attr.split(" in "),o=taco.string.trim(r[0]),a=taco.string.trim(r[1]),i=n.source.getTextByName(a),void 0!==i)for(l=0,c=i.length,s=[];c>l;l++)s.push(n.tag.evalLoopDoubleBrackets(t.inside,o,i[l],l,c));e=taco.string.build(t.before,s.join(""),t.after)}return e},n.doText=function(e){return n.tag.evalDoubleBrackets(e,n.source.getTextMap())},n.init=function(){n.searchBracketAndAddQueue(),n.source.startLoad(t.makeSource)},n.searchBracketAndAddQueue=function(){for(var e,t,o,a,i="{%\\s*%s\\s*(.*?)\\s*%}",l=["text","extends","insert"],c=0,s=0,u=l.length;u>c;c++)if(e=l[c],t=r.source.match(new RegExp(taco.string.sprintf(i,e),"ig")),null!==t)for(s=0;s<t.length;s++)o=t[s].substring(1,t[s].length-1).replace(e,"").replace(/%/gi,"").replace(/\s/gi,""),o=n.tag.evalDoubleBrackets(o),a=taco.net.urlFileName(o,null),null!==a&&n.source.addQueue("text"===e?"text":"view",a,o)},n.init.call(t)}(e)},taco.jquery={extend:function(){if(void 0!==jQuery){var e=arguments[0],t=arguments[1];jQuery.fn[e]=function(){for(var r=this,n=arguments[0],o=Array.prototype.slice.call(arguments,1),a=0,i=r.length;i>a;a++){if("object"!=typeof n&&void 0!==n)return r[a][e][n].apply(r[a][e],o);r[a][e]=new t(r[a],n)}return r},void 0!==arguments[2]&&(jQuery[e]=arguments[2])}},scrollElement:null,scrollTop:function(e,t){void 0!==jQuery&&(null===taco.jquery.scrollElement&&(taco.jquery.scrollElement=jQuery(taco.window().scrollElement())),t=jQuery.extend({duration:"fast",queue:!1},t),taco.jquery.scrollElement.stop().animate({scrollTop:e},t))}};